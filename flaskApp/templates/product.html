{% extends "base.html" %}
{% block title %}{{ product.name }} - Boutique{% endblock %}
{% block content %}
<div class="row">
  <div class="col-md-6">
    {% if product.image %}
      <img src="{{ url_for('uploads', filename=product.image) }}" class="img-fluid rounded shadow-sm" style="max-height:500px;object-fit:cover;">
    {% else %}
      <div class="bg-light d-flex align-items-center justify-content-center" style="height:400px;">
        <span class="text-muted">Pas d'image</span>
      </div>
    {% endif %}
  </div>

  <div class="col-md-6">
    <h2>{{ product.name }}</h2>
    {% if product.promo %}
      <div><span class="badge bg-success">Promo: {{ product.promo }}</span></div>
    {% endif %}
    <h4 class="mt-3">{{ product.price }} MAD</h4>
    <p class="mt-3">{{ product.description or "Description non fournie." }}</p>

    <!-- Formulaire Ajout au panier -->
    <form action="{{ url_for('cart_add', pid=product._id|string) }}" method="post" class="d-flex align-items-center gap-2">
      <input type="number" name="qty" value="1" min="1" class="form-control" style="width:100px;">
      <button class="btn btn-primary">Ajouter au panier</button>
    </form>

    {% if session.get('user_id') %}
      <form action="{{ url_for('post_comment', pid=product._id|string) }}" method="post" class="mt-4">
        <div class="mb-2">
          <label for="comment" class="form-label">Laisser un commentaire</label>
          <textarea name="comment" id="comment" class="form-control" rows="3" required></textarea>
        </div>
        <button class="btn btn-outline-secondary btn-sm">Poster</button>
      </form>
    {% else %}
      <div class="mt-4"><small>Connecte-toi pour laisser un commentaire.</small></div>
    {% endif %}
  </div>
</div>

<hr class="my-4">

<h5>Commentaires</h5>
{% if comments %}
  <div class="list-group">
    {% for c in comments %}
      <div class="list-group-item">
        <div class="d-flex justify-content-between">
          <strong>{{ c.user_id }}</strong>
          <small class="text-muted">{{ c.created_at.strftime('%Y-%m-%d %H:%M') if c.created_at else '' }}</small>
        </div>
        <p class="mb-0">{{ c.text }}</p>
      </div>
    {% endfor %}
  </div>
{% else %}
  <p class="text-muted">Aucun commentaire pour le moment.</p>
{% endif %}
{% endblock %}
